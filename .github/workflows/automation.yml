name: Run Python Script

on:
  push:
    branches:
      - main
  workflow_dispatch:
    inputs:
      TIMEZONE:
        description: "Podaj strefę czasową (CEST lub CET)"
        required: true
        type: string
        #default: "CEST"
      DATE1:
        description: "Podaj pierwszą datę (format: DD.MM.YYYY)"
        required: true
        type: string
      DATE2:
        description: "Podaj drugą datę (format: DD.MM.YYYY)"
        required: true
        type: string
      TIME1:
        description: "Podaj pierwszy czas (format: HH:MM)"
        required: true
        type: string
      TIME2:
        description: "Podaj drugi czas (format: HH:MM)"
        required: true
        type: string

jobs:
  run-script:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Ustawianie zmiennych środowiskowych
        run: |
          echo "TIMEZONE=${{ inputs.TIMEZONE }}" >> $GITHUB_ENV
          echo "DATE1=${{ inputs.DATE1 }}" >> $GITHUB_ENV
          echo "DATE2=${{ inputs.DATE2 }}" >> $GITHUB_ENV
          echo "TIME1=${{ inputs.TIME1 }}" >> $GITHUB_ENV
          echo "TIME2=${{ inputs.TIME2 }}" >> $GITHUB_ENV

      - name: Wypisanie zmiennych (DEBUG)
        run: |
          echo "TIMEZONE=$TIMEZONE"
          echo "DATE1=$DATE1"
          echo "DATE2=$DATE2"
          echo "TIME1=$TIME1"
          echo "TIME2=$TIME2"
      
      - name: Sprawdzenie, czy plik `Time_zone_generation.py` istnieje
        run: |
          ls -la
          if [ -f "Time_zone_generation.py" ]; then
            echo "✅ Plik Time_zone_generation.py został znaleziony."
          else
            echo "❌ Brak pliku Time_zone_generation.py! Sprawdź jego lokalizację w repozytorium."
            exit 1
          fi

      - name: Sprawdzenie zawartości skryptu przed uruchomieniem
        run: cat Time_zone_generation.py

      - name: Uruchamianie skryptu i przekierowanie wyników do logów
        run: |
          python Time_zone_generation.py "$TIMEZONE" "$DATE1" "$DATE2" "$TIME1" "$TIME2" | tee output.log

      - name: Wypisanie wyników skryptu w logach GitHub Actions
        run: cat output.log

      - name: Uruchamianie skryptu i zapis wyników
        run: |
          python3 -u Time_zone_generation.py "$TIMEZONE" "$DATE1" "$DATE2" "$TIME1" "$TIME2" | tee output.log
          echo "✅ Skrypt został wykonany. Oczekiwane wyniki poniżej:"
          cat output.log